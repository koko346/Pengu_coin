<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CashReward: ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ü‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®</title>
    
    <script src='//libtl.com/sdk.js' data-zone='9797430' data-sdk='show_9797430'></script>
    
    <script data-project-id="4833">
        !function(){
            var s=document.currentScript,p=s.getAttribute('data-project-id')||'default';
            // Only one source is kept for simplicity and to honor the single ID request
            var d=['https://ad.gigapub.tech'],i=0,t,sc;
            
            // Function to set up the fallback if Gigapub is not loaded
            function setupGigaFallback() {
                const adShow = window.show_9797430;
                if (typeof adShow === 'function' && window.showGiga === undefined) {
                    window.showGiga = () => new Promise((resolve, reject) => {
                        try {
                            // Call the legacy ad show for fallback
                            adShow(); 
                            resolve(); 
                        } catch (e) {
                            reject(e);
                        }
                    });
                } else if (window.showGiga === undefined) {
                    // Placeholder for when no ad SDK is available
                    window.showGiga = () => new Promise((resolve, reject) => {
                         console.error("No Ad SDK function found.");
                         reject(new Error("Ad service unavailable."));
                    });
                }
            }

            // Fallback setup immediately in case the timeout is reached
            setupGigaFallback();

            function l(){
                sc=document.createElement('script');
                sc.async=true;
                sc.src=d[i]+'/script?id='+p;
                clearTimeout(t);
                // Set a timeout for loading the script (e.g., 10 seconds)
                t=setTimeout(function(){
                    sc.onload=sc.onerror=null;
                    sc.src='';
                    // Since only one source is kept, we call the fallback directly if it fails
                    setupGigaFallback(); 
                },10000);
                sc.onload=function(){clearTimeout(t)};
                sc.onerror=function(){clearTimeout(t); setupGigaFallback()}; // Load fallback on error
                document.head.appendChild(sc);
            }
            l();
        }();
    </script>

    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Tailwind configuration for custom colors and fonts */
        body { font-family: 'Inter', sans-serif; background-color: #121212; color: #ffffff; }
        .dark-bg { background-color: #121212; }
        .card-bg { background-color: #1e1e1e; }
        .border-accent { border-color: #ff8c00; }
        .text-accent { color: #ff8c00; }
        .btn, .btn-accent, .btn-outline-accent { transition: all 0.2s ease-in-out; transform: scale(1); }
        .btn:active, .btn-accent:active, .btn-outline-accent:active { transform: scale(0.95); }
        .btn-accent { background-color: #ff8c00; color: #121212; font-weight: bold; }
        .btn-accent:hover { background-color: #e67e00; }
        .btn-outline-accent { border: 1px solid #ff8c00; color: #ff8c00; }
        .btn-outline-accent:hover { background-color: #ff8c00; color: #121212; }
        .input-field { background-color: #2c2c2c; border: 1px solid #444; }
        .main-page { display: none; }
        .main-page.active { display: flex; animation: fadeIn 0.5s ease-in-out; }
        .sub-page { display: none; }
        .sub-page.active { display: block; animation: fadeIn 0.3s ease-in-out; }
        .bottom-nav a.active { color: #ff8c00; }
        .notification-dot {
            position: absolute; top: -2px; right: -2px; width: 10px; height: 10px;
            background-color: #ef4444; border-radius: 50%; border: 2px solid #121212; display: none;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Professional Loading Screen Style */
        #loader {
            background-color: #121212; /* Dark background */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 1;
            transition: opacity 0.5s ease-in-out;
        }
        #loader.hidden-fade {
            opacity: 0;
            pointer-events: none; /* Disable interaction during fade out */
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top-color: #ff8c00; /* Accent color */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="max-w-md mx-auto">

    <div id="loader" class="fixed inset-0 z-50">
        <div class="spinner mb-4"></div>
        <p class="text-white text-lg font-semibold">Money Boom üí£.....</p>
    </div>

    <div id="app-container" class="min-h-screen flex-col main-page">
        <header class="flex items-center justify-between p-4 sticky top-0 bg-opacity-80 backdrop-blur-md z-10 dark-bg">
            <h1 class="text-xl font-bold">CashReward</h1>
            <div class="flex items-center space-x-4">
                <div id="notification-bell" class="relative cursor-pointer">
                    <i data-lucide="bell" class="w-6 h-6"></i>
                    <div id="notification-dot" class="notification-dot"></div>
                </div>
                <i data-lucide="user" class="w-6 h-6 cursor-pointer" onclick="navigateTo('profile-page')"></i>
            </div>
        </header>

        <main class="flex-grow">
            <div id="home-page" class="p-4 space-y-6 sub-page">
                <div class="card-bg p-4 rounded-lg flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p>
                        <p class="text-3xl font-bold">‡ß≥<span id="balance-amount">0.00</span></p>
                    </div>
                    <button id="home-withdraw-btn" class="bg-white text-black font-semibold px-6 py-2 rounded-lg">‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</button>
                </div>
                <section>
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <h2 class="text-lg font-semibold">‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶ï‡¶æ‡¶ú</h2>
                            <p class="text-sm text-gray-400">‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶™‡ßá‡¶§‡ßá ‡¶ï‡¶æ‡¶ú‡¶ó‡ßÅ‡¶≤‡¶ø ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
                        </div>
                        <p class="text-sm text-gray-400">‡¶¨‡¶æ‡¶ï‡¶ø ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®: <span id="ads-left-count">...</span></p>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-orange-500 p-4 rounded-lg flex flex-col sm:flex-row items-center justify-between text-black shadow-lg">
                            <div class="flex flex-col space-y-2 items-center sm:items-start text-center sm:text-left">
                                <div class="flex items-center space-x-4">
                                    <span class="text-5xl">üì∫</span> <div>
                                        <h3 class="text-xl font-bold">‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® (‡ß≥8)</h3>
                                        <p class="text-sm font-medium">Gigapub Ads ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ ‡¶ö‡¶æ‡¶≤‡¶ø‡¶§</p>
                                    </div>
                                </div>
                            </div>
                            <button class="mt-4 sm:mt-0 bg-white text-orange-500 font-bold px-8 py-3 rounded-lg text-base btn" onclick="claimReward('gigapub')">‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
                        </div>
                        
                        <div id="telegram-task" class="card-bg p-4 rounded-lg flex flex-col sm:flex-row items-center justify-between shadow-md">
                            <div class="flex items-center space-x-4">
                                <span class="text-3xl">‚úàÔ∏è</span>
                                <div>
                                    <h3 class="font-semibold text-lg">Telegram ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡¶® (‡ß≥20)</h3>
                                    <p class="text-sm text-gray-400">‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ ‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞</p>
                                </div>
                            </div>
                            <button id="join-telegram-btn" class="mt-4 sm:mt-0 bg-blue-500 text-white font-bold px-8 py-2 rounded-lg text-sm btn">‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡¶®</button>
                        </div>
                        
                    </div>
                </section>
            </div>

            <div id="wallet-page" class="p-4 space-y-6 sub-page">
                <h2 class="text-xl font-bold text-center">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤‡ßá‡¶ü (‡ß≥)</h2>
                <div class="card-bg p-4 rounded-lg">
                    <h3 class="font-semibold mb-3">‡¶Ü‡¶Ø‡¶º ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                    <p class="text-sm text-gray-400 mb-1">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: <span class="font-bold text-accent">‡ß≥<span id="wallet-balance-amount">0.00</span></span></p>
                    <p class="text-sm text-gray-400 mb-4">‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®: <span id="min-withdrawal-info" class="font-bold text-accent">‡ß≥1500</span></p>
                    <p class="text-sm text-red-400 mb-4 font-bold">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá <span id="min-referral-info">15‡¶ü‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤</span> ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡•§</p>
                    <input id="withdraw-amount" type="number" placeholder="‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (‡¶ü‡¶æ‡¶ï‡¶æ)" class="w-full p-3 rounded-lg input-field mb-3">
                    <select id="withdraw-method" class="w-full p-3 rounded-lg input-field mb-3">
                        <option value="bKash">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ (bKash)</option>
                        <option value="Nagad">‡¶®‡¶ó‡¶¶ (Nagad)</option>
                    </select>
                    <div id="payment-details-container">
                        <input id="payment-detail-input" type="text" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ bKash ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" class="w-full p-3 rounded-lg input-field">
                    </div>
                    <button id="withdraw-btn" class="w-full p-3 rounded-lg btn-accent mt-3">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-3">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</h3>
                    <div id="withdrawal-history-list" class="space-y-3"></div>
                </div>
            </div>

            <div id="refer-page" class="p-4 space-y-6 sub-page">
                 <h2 class="text-xl font-bold text-center">‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶ï‡ßá ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶â‡¶™‡¶æ‡¶∞‡ßç‡¶ú‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
                 <div class="card-bg p-6 rounded-lg text-center">
                     <p class="text-gray-400 mb-2">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï</p>
                     <div class="bg-gray-800 p-3 rounded-lg flex items-center justify-center mb-4">
                         <span id="referral-link" class="text-sm md:text-base font-bold tracking-tight break-all"></span>
                         <button id="copy-link-btn" class="ml-4"><i data-lucide="copy" class="w-6 h-6 text-gray-400"></i></button>
                     </div>
                     <p class="text-sm text-gray-300">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
                     <p class="text-sm text-gray-300 mt-2 font-semibold">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤: <span id="referral-count-display">0</span></p>
                 </div>
                 <button id="share-btn" class="w-full p-3 rounded-lg btn-accent">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                 <div class="card-bg p-4 rounded-lg mt-6">
                    <h3 class="font-semibold mb-3 text-center">‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶ï‡¶æ‡¶∞‡ßã ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶è‡¶∏‡ßá‡¶õ‡ßá‡¶®?</h3>
                    <p class="text-sm text-gray-400 text-center mb-3">‡¶Ø‡ßã‡¶ó‡¶¶‡¶æ‡¶® ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡¶§‡ßá ‡¶è‡¶¨‡¶Ç ‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡ßá‡¶§‡ßá ‡¶®‡ßÄ‡¶ö‡ßá‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï‡¶ü‡¶ø‡¶§‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®:</p>
                    <a id="referrer-link-placeholder" href="http://t.me/money_boom_io_bot" target="_blank" class="w-full p-3 rounded-lg btn-outline-accent flex justify-center items-center">
                        <i data-lucide="link" class="w-5 h-5 mr-2"></i>
                        ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï
                    </a>
                 </div>
            </div>

            <div id="profile-page" class="p-4 space-y-6 sub-page">
                <h2 class="text-xl font-bold text-center mb-4">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</h2>
                <div class="flex flex-col items-center">
                    <p id="profile-id" class="text-gray-400">ID: ...</p>
                </div>
                <div class="card-bg p-4 rounded-lg space-y-3">
                    <div class="flex justify-between items-center"><p class="font-medium">‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶Ø‡¶º</p><p id="total-income" class="font-bold text-accent">‡ß≥0.00</p></div>
                    <div class="flex justify-between items-center"><p class="font-medium">‡¶¶‡ßá‡¶ñ‡¶æ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®</p><p id="total-ads-watched" class="font-bold">0</p></div>
                    <div class="flex justify-between items-center"><p class="font-medium">‡¶Æ‡ßã‡¶ü ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º‡¶ï‡¶æ‡¶≤</p><p id="work-duration" class="font-bold">0 ‡¶¶‡¶ø‡¶®</p></div>
                    </div>
            </div>
            
            <div id="notifications-page" class="p-4 space-y-4 sub-page">
                <h2 class="text-xl font-bold text-center">‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®</h2>
                <div id="notifications-list" class="space-y-3">
                    <p class="text-gray-400 text-center">‡¶ï‡ßã‡¶® ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶®‡ßá‡¶á‡•§</p>
                </div>
            </div>
        </main>

        <nav class="bottom-nav sticky bottom-0 grid grid-cols-4 items-center text-center py-2 card-bg">
            <a href="#" class="nav-link active text-accent" data-page="home-page"><i data-lucide="home" class="mx-auto w-6 h-6"></i><span class="text-xs">‡¶π‡ßã‡¶Æ</span></a>
            <a href="#" class="nav-link" data-page="wallet-page"><i data-lucide="wallet" class="mx-auto w-6 h-6"></i><span class="text-xs">‡¶ì‡¶Ø‡¶º‡¶æ‡¶≤‡ßá‡¶ü</span></a>
            <a href="#" class="nav-link" data-page="refer-page"><i data-lucide="users" class="mx-auto w-6 h-6"></i><span class="text-xs">‡¶∞‡ßá‡¶´‡¶æ‡¶∞</span></a>
            <a href="#" class="nav-link" data-page="profile-page"><i data-lucide="user" class="mx-auto w-6 h-6"></i><span class="text-xs">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</span></a>
        </nav>
    </div>
    
    <div id="custom-alert" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-lg p-6 w-full max-w-sm text-center">
            <p id="alert-message" class="mb-4 text-white"></p>
            <button id="alert-ok-btn" class="btn-accent px-6 py-2 rounded-lg"></button> 
        </div>
    </div>

    <script>
        // --- Static Configuration & Rewards (‡¶ü‡¶æ‡¶ï‡¶æ‡¶Ø‡¶º) ---
        const REWARD_AD_GIGAPUB = 8.00;     // ‡ß≥8.00 per Gigapub ad
        const REWARD_TELEGRAM_JOIN = 20.00; // ‡ß≥20.00 one-time bonus
        const MIN_WITHDRAWAL = 1500.00;     // ‡ß≥1500.00 minimum withdrawal
        const DAILY_AD_LIMIT = 50;          // Daily ad limit
        const MIN_REFERRALS_FOR_WITHDRAWAL = 15; // NEW: Minimum referrals required for withdrawal

        const TELEGRAM_CHANNEL_URL = 'https://t.me/moneyhostes'; // Updated Telegram Link
        const REFERRAL_BASE_URL = 'http://t.me/money_boom_io_bot';

        // --- DOM Elements ---
        const loader = document.getElementById('loader');
        const balanceAmountEl = document.getElementById('balance-amount');
        const walletBalanceAmountEl = document.getElementById('wallet-balance-amount');
        const adsLeftCountEl = document.getElementById('ads-left-count');
        const referralLinkEl = document.getElementById('referral-link');
        const referralCountDisplayEl = document.getElementById('referral-count-display'); // **‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ó‡¶£‡¶®‡¶æ ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶®‡ßá‡¶∞ ‡¶â‡¶™‡¶æ‡¶¶‡¶æ‡¶®**
        const withdrawMethodSelect = document.getElementById('withdraw-method');
        const paymentDetailsContainer = document.getElementById('payment-details-container');
        const telegramTaskEl = document.getElementById('telegram-task');
        const joinTelegramBtn = document.getElementById('join-telegram-btn');

        // Profile Elements
        const profileIdEl = document.getElementById('profile-id');
        const totalIncomeEl = document.getElementById('total-income');
        const totalAdsWatchedEl = document.getElementById('total-ads-watched');
        const workDurationEl = document.getElementById('work-duration');

        // --- Local Data Structure and Initialization ---
        let userData = {};
        let currentUserId = localStorage.getItem('guestUserId');

        // Initial Data Setup
        function initializeUserData() {
            if (!currentUserId) {
                currentUserId = 'GUEST_' + Math.random().toString(36).substring(2, 10).toUpperCase();
                localStorage.setItem('guestUserId', currentUserId);
            }
            const savedData = localStorage.getItem(`userData_${currentUserId}`);
            if (savedData) {
                userData = JSON.parse(savedData);
                // Ensure new fields exist in old data structures
                if (userData.referralsCount === undefined) userData.referralsCount = 0;
            } else {
                userData = {
                    uid: currentUserId,
                    balance: 0.00,
                    totalIncome: 0.00,
                    adsWatched: 0,
                    dailyAdCount: 0,
                    lastAdWatchDate: new Date().toISOString().split('T')[0],
                    isTelegramJoined: false,
                    workStartDate: new Date().toISOString().split('T')[0],
                    referralsCount: 0, // **‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ó‡¶£‡¶®‡¶æ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£‡ßá‡¶∞ ‡¶ï‡ßç‡¶∑‡ßá‡¶§‡ßç‡¶∞**
                    withdrawals: []
                };
                saveUserData();
            }
        }

        function saveUserData() {
            localStorage.setItem(`userData_${currentUserId}`, JSON.stringify(userData));
        }

        // --- UI Update & Logic ---
        function updateUI() {
            // Balance
            balanceAmountEl.textContent = userData.balance.toFixed(2);
            walletBalanceAmountEl.textContent = userData.balance.toFixed(2);

            // Ads Count
            updateAdsLeftCount();

            // Referral Link and Count
            referralLinkEl.textContent = `${REFERRAL_BASE_URL}?start=${currentUserId}`;
            referralCountDisplayEl.textContent = userData.referralsCount; // **‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü**

            // Telegram Task
            if (userData.isTelegramJoined) {
                telegramTaskEl.classList.add('opacity-50');
                joinTelegramBtn.textContent = '‡¶¶‡¶æ‡¶¨‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá';
                joinTelegramBtn.disabled = true;
                joinTelegramBtn.classList.remove('bg-blue-500');
                joinTelegramBtn.classList.add('bg-gray-600', 'cursor-not-allowed');
            } else {
                 joinTelegramBtn.disabled = false;
                 joinTelegramBtn.textContent = '‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡¶®';
                 joinTelegramBtn.classList.remove('bg-gray-600', 'cursor-not-allowed');
                 joinTelegramBtn.classList.add('bg-blue-500');
            }

            // Profile Data
            profileIdEl.textContent = `ID: ${userData.uid}`;
            totalIncomeEl.textContent = `‡ß≥${userData.totalIncome.toFixed(2)}`;
            totalAdsWatchedEl.textContent = userData.adsWatched;
            workDurationEl.textContent = calculateWorkDuration();

            // Withdrawal Fields
            updateDynamicPaymentFields();
            loadWithdrawalHistory();
        }

        function calculateWorkDuration() {
            const startDate = new Date(userData.workStartDate);
            const today = new Date();
            const diffTime = Math.abs(today - startDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
            return `${diffDays} ‡¶¶‡¶ø‡¶®`;
        }

        function updateAdsLeftCount() {
            const today = new Date().toISOString().split('T')[0];
            if (userData.lastAdWatchDate !== today) {
                userData.dailyAdCount = 0;
                userData.lastAdWatchDate = today;
                saveUserData();
            }
            const adsLeft = Math.max(0, DAILY_AD_LIMIT - userData.dailyAdCount);
            adsLeftCountEl.textContent = adsLeft;
        }

        function updateDynamicPaymentFields() {
            const selectedMethod = withdrawMethodSelect.value.toLowerCase();
            let placeholder = "‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®";
            if (selectedMethod.includes('bkash')) placeholder = "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ bKash ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®";
            if (selectedMethod.includes('nagad')) placeholder = "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Nagad ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®";
            
            paymentDetailsContainer.innerHTML = `<input id="payment-detail-input" type="text" placeholder="${placeholder}" class="w-full p-3 rounded-lg input-field">`;
        }

        function loadWithdrawalHistory() {
            const historyList = document.getElementById('withdrawal-history-list');
            const withdrawals = userData.withdrawals;
            
            if (withdrawals.length === 0) {
                historyList.innerHTML = '<p class="text-gray-400 text-center">‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶® ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßá‡¶®‡¶®‡¶ø‡•§</p>';
                return;
            }

            withdrawals.sort((a, b) => new Date(b.requestedAt) - new Date(a.requestedAt));
            historyList.innerHTML = '';

            withdrawals.forEach(request => {
                const status = request.status;
                let statusColor = 'text-yellow-400';
                if (status === 'approved') statusColor = 'text-green-400';
                else if (status === 'rejected') statusColor = 'text-red-400';
                
                const date = new Date(request.requestedAt).toLocaleDateString('bn-BD') || 'N/A';

                historyList.innerHTML += `<div class="card-bg p-3 rounded-lg flex items-center justify-between">
                    <div>
                        <p class="font-semibold">‡ß≥${request.amount.toFixed(2)} - ${request.method}</p>
                        <p class="text-xs text-gray-400">${date}</p>
                    </div>
                    <p class="font-bold ${statusColor} capitalize">${status}</p>
                </div>`;
            });
        }

        // --- Handlers ---
        
        async function handleTelegramJoin() {
            if (userData.isTelegramJoined) return showAlert("‡¶Ü‡¶™‡¶®‡¶ø ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá‡¶á ‡¶è‡¶á ‡¶ï‡¶æ‡¶ú‡¶ü‡¶ø ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®‡•§");
            
            // 1. Open Telegram Link
            window.open(TELEGRAM_CHANNEL_URL, '_blank');
            
            // 2. Ask User for Confirmation (Assuming they joined)
            // Give the user a moment to switch and join before asking
            setTimeout(async () => {
                const confirmJoin = await showConfirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø Telegram ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®?");
            
                if (confirmJoin) {
                    // 3. Apply Reward
                    const newBalance = userData.balance + REWARD_TELEGRAM_JOIN;
                    const newTotalIncome = userData.totalIncome + REWARD_TELEGRAM_JOIN;

                    userData.balance = newBalance;
                    userData.totalIncome = newTotalIncome;
                    userData.isTelegramJoined = true;
                    saveUserData();
                    updateUI();
                    showAlert(`‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! ‡¶Ü‡¶™‡¶®‡¶ø Telegram ‡¶ú‡¶Ø‡¶º‡ßá‡¶® ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡ß≥${REWARD_TELEGRAM_JOIN.toFixed(2)} ‡¶ú‡¶ø‡¶§‡ßá‡¶õ‡ßá‡¶®‡•§`);
                } else {
                    showAlert("‡¶™‡ßÅ‡¶∞‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶™‡ßá‡¶§‡ßá ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡¶®‡•§");
                }
            }, 500); // 0.5 sec delay before asking for confirmation
        }

        window.claimReward = async function(taskType) {
            const today = new Date().toISOString().split('T')[0];
            
            // Check daily ad limit for the specific ad task
            if (taskType === 'gigapub') {
                if (userData.lastAdWatchDate !== today) {
                    userData.dailyAdCount = 0;
                    userData.lastAdWatchDate = today;
                    saveUserData();
                }

                if (userData.dailyAdCount >= DAILY_AD_LIMIT) {
                    return showAlert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶∏‡ßÄ‡¶Æ‡¶æ ‡¶∂‡ßá‡¶∑ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
                }
            }
            
            let adPromise;
            let adSDKAvailable = false;
            
            // Use Gigapub for the 'gigapub' task
            if (taskType === 'gigapub' && typeof window.showGiga === 'function') {
                adPromise = window.showGiga();
                adSDKAvailable = true;
            } 

            if (!adSDKAvailable) {
                // This will use the setupGigaFallback placeholder if the script failed
                return showAlert("‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶™‡¶∞‡¶ø‡¶∑‡ßá‡¶¨‡¶æ ‡¶è‡¶ñ‡¶® ‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß ‡¶®‡ßá‡¶á‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶™‡¶∞‡ßá ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
            }
            
            // Show loading spinner while ad is being prepared
            loader.style.display = 'flex';

            adPromise.then(() => {
                loader.style.display = 'none'; // Hide loader after ad attempt

                let rewardAmount = 0.00;
                let isAdTask = false;

                if (taskType === 'gigapub') {
                    rewardAmount = REWARD_AD_GIGAPUB; // ‡ß≥8
                    isAdTask = true;
                }

                if (rewardAmount > 0) {
                    userData.balance += rewardAmount;
                    userData.totalIncome += rewardAmount;
                    if (isAdTask) {
                        userData.dailyAdCount += 1;
                        userData.adsWatched += 1;
                    }
                    saveUserData();
                    updateUI();
                    showAlert(`‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! ‡¶Ü‡¶™‡¶®‡¶ø ‡ß≥${rewardAmount.toFixed(2)} ‡¶ú‡¶ø‡¶§‡ßá‡¶õ‡ßá‡¶®‡•§`);
                } else {
                    showAlert("‡¶ï‡¶æ‡¶ú ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
                }
                
            }).catch(e => {
                loader.style.display = 'none'; // Hide loader on error
                console.error("Ad error:", e);
                showAlert('‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§');
            });
        }

        async function handleWithdrawal() {
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            const method = withdrawMethodSelect.value;
            const paymentDetailInput = document.getElementById('payment-detail-input');
            const paymentDetail = paymentDetailInput ? paymentDetailInput.value.trim() : '';

            if (isNaN(amount) || amount <= 0) return showAlert("‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶†‡¶ø‡¶ï ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§");
            if (amount < MIN_WITHDRAWAL) return showAlert(`‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡ß≥${MIN_WITHDRAWAL.toFixed(2)}‡•§`);
            if (amount > userData.balance) return showAlert("‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á‡•§");
            if (!paymentDetail) return showAlert(`‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (${method} ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞)‡•§`);

            // --- NEW: Referral Check Logic ---
            if (amount >= MIN_WITHDRAWAL && userData.referralsCount < MIN_REFERRALS_FOR_WITHDRAWAL) {
                 return showAlert(`‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶≤‡ßá ‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ${MIN_REFERRALS_FOR_WITHDRAWAL} ‡¶ü‡¶æ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§ ${MIN_REFERRALS_FOR_WITHDRAWAL} ‡¶ü‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§`);
            }
            // --- END NEW Logic ---

            // Process Withdrawal Request (Local Mock)
            try {
                // Deduct balance
                userData.balance -= amount;

                // Add to history
                userData.withdrawals.push({
                    amount: amount, 
                    method: method, 
                    paymentDetail: paymentDetail, 
                    status: "pending", // Always pending locally
                    requestedAt: new Date().toISOString()
                });
                
                saveUserData();
                updateUI();

                showAlert("‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                document.getElementById('withdraw-amount').value = '';
                paymentDetailInput.value = '';

            } catch (error) {
                showAlert("‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ: " + error.message);
            }
        }
        
        // Removed handleLogout function as requested

        function copyReferralLink() {
            const textToCopy = referralLinkEl.textContent;
            const textArea = document.createElement("textarea");
            textArea.style.position = 'fixed'; textArea.style.top = '-100px';
            textArea.value = textToCopy;
            document.body.appendChild(textArea);
            textArea.focus(); textArea.select();
            try {
                // Use modern Clipboard API if available, fallback to execCommand
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(textToCopy);
                } else {
                    document.execCommand('copy');
                }
                showAlert("‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
            } catch (err) {
                showAlert("‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§");
            }
            document.body.removeChild(textArea);
        }
        
        function shareReferralLink() {
            const text = `CashReward ‡¶è ‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶™‡¶æ‡¶∞‡ßç‡¶ú‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®! ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡ßá‡¶§‡ßá ‡¶è‡¶á ‡¶≤‡¶ø‡¶Ç‡¶ï‡¶ü‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®: ${referralLinkEl.textContent}`;
            if (navigator.share) {
                navigator.share({ title: 'CashReward ‡¶è ‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡¶®!', text: text, url: referralLinkEl.textContent })
                    .catch((error) => console.error("Share failed:", error));
            } else {
                copyReferralLink();
                showAlert("‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞ ‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß ‡¶®‡ßá‡¶á‡•§ ‡¶è‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡ßá ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
            }
        }

        // --- Utility Functions ---

        function showAlert(message) {
            document.getElementById('alert-message').textContent = message;
            
            const alertEl = document.getElementById('custom-alert');
            const okBtn = document.getElementById('alert-ok-btn');
            
            // Remove confirm-specific button if present
            const cancelBtn = document.getElementById('alert-cancel-btn');
            if (cancelBtn) cancelBtn.remove();
            
            okBtn.textContent = '‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá';
            okBtn.onclick = () => {
                alertEl.classList.add('hidden');
            };
            
            alertEl.classList.remove('hidden');
        }

        function showConfirm(message) {
            return new Promise((resolve) => {
                const alertEl = document.getElementById('custom-alert');
                const msgEl = document.getElementById('alert-message');
                const okBtn = document.getElementById('alert-ok-btn');
                
                // Add a cancel button for confirmation
                let cancelBtn = document.getElementById('alert-cancel-btn');
                if (!cancelBtn) {
                    cancelBtn = document.createElement('button');
                    cancelBtn.id = 'alert-cancel-btn';
                    cancelBtn.className = 'btn-outline-accent px-6 py-2 rounded-lg ml-3';
                    alertEl.querySelector('.bg-gray-800').appendChild(cancelBtn);
                }
                
                cancelBtn.textContent = '‡¶®‡¶æ';

                msgEl.textContent = message;
                alertEl.classList.remove('hidden');

                okBtn.textContent = '‡¶π‡ßç‡¶Ø‡¶æ‡¶Å';
                okBtn.onclick = () => {
                    alertEl.classList.add('hidden');
                    resolve(true);
                };
                
                cancelBtn.onclick = () => {
                    alertEl.classList.add('hidden');
                    resolve(false);
                };
            });
        }
        
        function navigateTo(pageId) {
            document.querySelectorAll('.sub-page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active', 'text-accent');
                if (link.dataset.page === pageId) link.classList.add('active', 'text-accent');
            });
        }
        window.navigateTo = navigateTo; // Make it globally accessible for inline calls

        function setupEventListeners() {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    navigateTo(link.dataset.page);
                });
            });
            document.getElementById('notification-bell').addEventListener('click', () => { navigateTo('notifications-page'); });
            document.getElementById('copy-link-btn').addEventListener('click', copyReferralLink);
            document.getElementById('share-btn').addEventListener('click', shareReferralLink);
            document.getElementById('withdraw-btn').addEventListener('click', handleWithdrawal);
            document.getElementById('home-withdraw-btn').addEventListener('click', () => navigateTo('wallet-page'));
            document.getElementById('join-telegram-btn').addEventListener('click', handleTelegramJoin);
            withdrawMethodSelect.addEventListener('change', updateDynamicPaymentFields);
        }

        // --- App Start ---
        window.onload = () => {
            lucide.createIcons();
            initializeUserData();
            setupEventListeners();
            updateUI();
            
            // Show main app and hide loader after 5 seconds (5000ms)
            setTimeout(() => {
                loader.classList.add('hidden-fade');
                setTimeout(() => {
                    loader.style.display = 'none';
                    document.getElementById('app-container').classList.add('active');
                    navigateTo('home-page'); // Start on home page
                }, 500); // Wait for fade-out transition
            }, 5000); 
        };
    </script>
</body>
</html>
